<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram App</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Rubik', sans-serif; }
        * { border-color: #e3e3e3; }
        .spinner { border: 4px solid #e3e3e3; border-top: 4px solid white; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .main-bg { background: #fcfcfc; background-image: radial-gradient(circle, #999999 1px, transparent 1px); background-size: 20px 20px; }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 bg-[#1d1c1b] flex items-center justify-center z-50">
        <div class="spinner"></div>
    </div>

    <!-- Language Modal -->
    <div id="lang-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 hidden">
        <div class="bg-white p-4 rounded">
            <p class="mb-4">Choose Language / Выберите язык</p>
            <button id="lang-en" class="px-4 py-2 bg-gray-200 rounded mr-2">English</button>
            <button id="lang-ru" class="px-4 py-2 bg-gray-200 rounded">Русский</button>
        </div>
    </div>

    <!-- Main Screen -->
    <div id="main" class="main-bg min-h-screen hidden">
        <div id="categories" class="overflow-x-auto whitespace-nowrap py-2 border-b"></div>
        <div class="flex justify-between p-2 bg-[#f8f7f6] border-b">
            <button id="f-city" class="w-6 h-6 border rounded flex items-center justify-center"><img src="city.svg" class="w-4 h-4"></button>
            <button id="f-gender" class="w-6 h-6 border rounded flex items-center justify-center"><img src="gender.svg" class="w-4 h-4"></button>
            <button id="f-age" class="w-6 h-6 border rounded flex items-center justify-center"><img src="age.svg" class="w-4 h-4"></button>
            <button id="f-date" class="w-6 h-6 border rounded flex items-center justify-center"><img src="date.svg" class="w-4 h-4"></button>
            <button id="f-sort" class="w-6 h-6 border rounded flex items-center justify-center"><img src="sort.svg" class="w-4 h-4"></button>
            <button id="f-notif" class="w-6 h-6 border rounded flex items-center justify-center"><img src="notification.svg" class="w-4 h-4"></button>
        </div>
        <div id="feed" class="p-2 space-y-2"></div>
    </div>

    <!-- Filter Modals -->
    <div id="m-city" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-xl p-4 hidden z-50">
        <div class="flex justify-between mb-2"><span>Город</span><button class="close text-gray-500">&times;</button></div>
        <input id="city-search" class="w-full p-2 border rounded mb-2" placeholder="Поиск">
        <div id="city-options" class="space-y-1"></div>
    </div>
    <div id="m-gender" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-xl p-4 hidden z-50">
        <div class="flex justify-between mb-2"><span>Пол</span><button class="close text-gray-500">&times;</button></div>
        <div class="space-y-1"><button>Все</button><button>Мужской</button><button>Женский</button></div>
    </div>
    <div id="m-age" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-xl p-4 hidden z-50">
        <div class="flex justify-between mb-2"><span>Возраст</span><button class="close text-gray-500">&times;</button></div>
        <div class="space-y-1"><button>Все</button><button>16-25</button><button>25-35</button><button>35-45</button><button>45+</button></div>
    </div>
    <div id="m-date" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-xl p-4 hidden z-50">
        <div class="flex justify-between mb-2"><span>Дата</span><button class="close text-gray-500">&times;</button></div>
        <div class="space-y-1"><button>Все</button><button>Сегодня</button><button>Завтра</button><button>На неделе</button><button>В этом месяце</button></div>
    </div>
    <div id="m-sort" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-xl p-4 hidden z-50">
        <div class="flex justify-between mb-2"><span>Сортировка</span><button class="close text-gray-500">&times;</button></div>
        <div class="space-y-1"><button>Мои</button><button>Избранные</button><button>Скрытые</button><hr><button>Новые</button><button>Старые</button><button>По рейтингу</button></div>
    </div>
    <div id="m-notif" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-xl p-4 hidden z-50">
        <div class="flex justify-between mb-2"><span>Уведомления</span><button class="close text-gray-500">&times;</button></div>
        <div class="space-y-1"><label><input type="checkbox" id="n-likes"> Лайки</label><label><input type="checkbox" id="n-sys"> Системные</label><label><input type="checkbox" id="n-acc"> Аккаунт</label><button id="n-save" class="w-full py-1 bg-gray-200 rounded mt-2">Сохранить</button></div>
    </div>
    <div id="m-post" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-xl p-4 hidden z-50">
        <div id="post-options" class="space-y-1"></div>
    </div>

    <script>
        const user = { id: 1, name: 'Я', username: 'me', logo: 'me.jpg' };
        let lang = 'ru', filters = { category: 'Все', city: 'Все', gender: 'Все', age: 'Все', date: 'Все', sort: 'Новые' };
        const favorites = new Set(), hidden = new Set(), liked = new Set();

        const categories = [{"ru": "Все", "en": "All"},{"ru": "Дружба", "en": "Friendship"},{"ru": "Прогулки", "en": "Walks"},{"ru": "События", "en": "Events"}];
        const cities = { ru: ["Москва", "Санкт-Петербург", "Новосибирск"], en: ["Moscow", "Saint Petersburg", "Novosibirsk"] };
        const posts = [
            { id: 1, creator: user, desc: "Ищу друга", cat: "Дружба", city: "Москва", gender: "Мужской", age: "25-35", date: "Сегодня", likes: 3, ts: 1 },
            { id: 2, creator: { id: 2, name: "Аня", username: "anya", logo: "anya.jpg" }, desc: "Гуляем?", cat: "Прогулки", city: "Санкт-Петербург", gender: "Женский", age: "16-25", date: "Завтра", likes: 5, ts: 2 },
            { id: 3, creator: { id: 3, name: "Иван", username: "ivan", logo: "ivan.jpg" }, desc: "Вечеринка", cat: "События", city: "Новосибирск", gender: "Мужской", age: "35-45", date: "На неделе", likes: 2, ts: 3 }
        ];

        setTimeout(() => { document.getElementById('loading').classList.add('hidden'); document.getElementById('lang-modal').classList.remove('hidden'); }, 1000);
        document.getElementById('lang-en').onclick = () => setLang('en');
        document.getElementById('lang-ru').onclick = () => setLang('ru');

        function setLang(l) {
            lang = l;
            document.getElementById('lang-modal').classList.add('hidden');
            document.getElementById('main').classList.remove('hidden');
            renderCategories();
            renderPosts();
        }

        function renderCategories() {
            const c = document.getElementById('categories');
            c.innerHTML = '';
            categories.forEach((cat, i) => {
                const btn = document.createElement('button');
                btn.textContent = cat[lang];
                btn.className = `px-3 py-1 ${i === 0 ? 'border-b-2 border-black rounded-b' : 'text-gray-500'}`;
                btn.onclick = () => {
                    c.querySelectorAll('button').forEach(b => { b.className = 'px-3 py-1 text-gray-500'; });
                    btn.className = 'px-3 py-1 border-b-2 border-black rounded-b';
                    filters.category = cat[lang];
                    renderPosts();
                    btn.scrollIntoView({ behavior: 'smooth', inline: 'center' });
                };
                c.appendChild(btn);
            });
        }

        function renderPosts() {
            let filtered = posts.filter(p => (
                (filters.category === 'Все' || p.cat === filters.category) &&
                (filters.city === 'Все' || p.city === filters.city) &&
                (filters.gender === 'Все' || p.gender === filters.gender) &&
                (filters.age === 'Все' || p.age === filters.age) &&
                (filters.date === 'Все' || p.date === filters.date) &&
                (filters.sort === 'Новые' || filters.sort === 'Старые' || filters.sort === 'По рейтингу' || 
                 (filters.sort === 'Мои' && p.creator.id === user.id) ||
                 (filters.sort === 'Избранные' && favorites.has(p.id)) ||
                 (filters.sort === 'Скрытые' && hidden.has(p.id)))
            ));
            if (filters.sort === 'Новые') filtered.sort((a, b) => b.ts - a.ts);
            if (filters.sort === 'Старые') filtered.sort((a, b) => a.ts - b.ts);
            if (filters.sort === 'По рейтингу') filtered.sort((a, b) => b.likes - a.likes);

            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            filtered.forEach(p => {
                const div = document.createElement('div');
                div.className = 'bg-white p-3 rounded';
                div.innerHTML = `
                    <p>${p.desc}</p><hr class="my-1">
                    <div class="flex justify-between">
                        <div class="flex items-center">
                            <img src="${p.creator.logo}" class="w-6 h-6 rounded-full mr-2">
                            <a href="https://t.me/${p.creator.username}" target="_blank">${p.creator.name}</a>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="like flex items-center" data-id="${p.id}">
                                <img src="lightning.svg" class="w-4 h-4 ${liked.has(p.id) ? 'text-[#c19433]' : ''}">
                                <span class="ml-1">${p.likes}</span>
                            </button>
                            <button class="menu" data-id="${p.id}"><img src="menu.svg" class="w-4 h-4"></button>
                        </div>
                    </div>`;
                feed.appendChild(div);
            });
        }

        ['city', 'gender', 'age', 'date', 'sort', 'notif'].forEach(f => {
            document.getElementById(`f-${f}`).onclick = () => document.getElementById(`m-${f}`).classList.remove('hidden');
        });

        document.querySelectorAll('.close').forEach(c => c.onclick = () => c.closest('.fixed').classList.add('hidden'));

        function renderCities(search = '') {
            const opts = document.getElementById('city-options');
            opts.innerHTML = '<button class="w-full p-1">Все</button>';
            cities[lang].filter(c => c.toLowerCase().includes(search.toLowerCase())).forEach(c => {
                opts.innerHTML += `<button class="w-full p-1">${c}</button>`;
            });
        }
        document.getElementById('city-search').oninput = e => renderCities(e.target.value);
        document.getElementById('m-city').onclick = e => { if (e.target.tagName === 'BUTTON') { filters.city = e.target.textContent; renderPosts(); e.target.closest('.fixed').classList.add('hidden'); } };
        ['gender', 'age', 'date', 'sort'].forEach(m => {
            document.getElementById(`m-${m}`).onclick = e => { if (e.target.tagName === 'BUTTON') { filters[m] = e.target.textContent; renderPosts(); e.target.closest('.fixed').classList.add('hidden'); } };
        });
        document.getElementById('n-save').onclick = () => {
            console.log({ likes: document.getElementById('n-likes').checked, sys: document.getElementById('n-sys').checked, acc: document.getElementById('n-acc').checked });
            document.getElementById('m-notif').classList.add('hidden');
        };

        document.addEventListener('click', e => {
            const t = e.target;
            if (t.closest('.like')) {
                const id = parseInt(t.closest('.like').dataset.id);
                const p = posts.find(p => p.id === id);
                if (liked.has(id)) { liked.delete(id); p.likes--; t.querySelector('img').classList.remove('text-[#c19433]'); } 
                else { liked.add(id); p.likes++; t.querySelector('img').classList.add('text-[#c19433]'); }
                t.querySelector('span').textContent = p.likes;
            }
            if (t.closest('.menu')) {
                const id = parseInt(t.closest('.menu').dataset.id), p = posts.find(p => p.id === id);
                const opts = document.getElementById('post-options');
                opts.innerHTML = (p.creator.id === user.id) ? 
                    '<button class="w-full p-1">Изменить</button><button class="w-full p-1">Поделиться</button><button class="w-full p-1">Удалить</button>' :
                    '<button class="w-full p-1">В избранное</button><button class="w-full p-1">Скрыть</button><button class="w-full p-1">Поделиться</button><button class="w-full p-1">Пожаловаться</button>';
                document.getElementById('m-post').classList.remove('hidden');
                opts.onclick = e => {
                    if (e.target.tagName === 'BUTTON') {
                        const act = e.target.textContent;
                        if (act === 'В избранное') favorites.add(id);
                        if (act === 'Скрыть') hidden.add(id);
                        renderPosts();
                        opts.parentElement.classList.add('hidden');
                    }
                };
            }
        });

        renderCities();
    </script>
</body>
</html>
