<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rubik', sans-serif;
            background: #fcfcfc;
            color: #1d1c1b;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(circle, #d3d3d3 1px, transparent 1px);
            background-size: 12px 12px;
            opacity: 0.2;
            z-index: -1;
        }

        /* –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1d1c1b;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #fff;
            margin-top: 20px;
            font-size: 16px;
            text-align: center;
            padding: 0 20px;
            line-height: 1.5;
        }

        .server-url {
            color: #888;
            font-size: 12px;
            margin-top: 10px;
            word-break: break-all;
        }

        /* –í—ã–±–æ—Ä —è–∑—ã–∫–∞ */
        .language-selection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1d1c1b;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9998;
        }

        .language-title {
            color: #fff;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 40px;
            text-align: center;
        }

        .language-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 200px;
        }

        .language-btn {
            padding: 16px 24px;
            background: #fff;
            color: #1d1c1b;
            border: none;
            border-radius: 12px;
            font-family: 'Rubik', sans-serif;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .language-btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .container {
            max-width: 100%;
            padding: 20px;
            box-sizing: border-box;
            display: none;
            text-align: center;
        }

        .container.visible {
            display: block;
        }

        .success-message {
            background: #4CAF50;
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 500;
        }

        .info-card {
            background: #fff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #f0f0f0;
        }

        .info-title {
            font-size: 18px;
            font-weight: 600;
            color: #1d1c1b;
            margin-bottom: 12px;
        }

        .info-text {
            color: #666;
            line-height: 1.5;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #4CAF50;
        }

        .status-offline {
            background: #f44336;
        }

        .debug-info {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
            margin-top: 16px;
            font-family: monospace;
            font-size: 12px;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
        }

        .retry-btn {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 16px;
        }

        .retry-btn:hover {
            background: #0056b3;
        }

        .warning-message {
            background: #ff9800;
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .error-message {
            background: #f44336;
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="loading-screen" id="loadingScreen">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...</div>
        <div class="server-url" id="serverUrl"></div>
    </div>

    <!-- –í—ã–±–æ—Ä —è–∑—ã–∫–∞ -->
    <div class="language-selection" id="languageSelection">
        <div class="language-title">–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ / Choose Language</div>
        <div class="language-buttons">
            <button class="language-btn" onclick="selectLanguage('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
            <button class="language-btn" onclick="selectLanguage('en')">üá¨üáß English</button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container" id="mainContainer">
        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SERVER_URL -->
        <div class="warning-message" id="urlWarning" style="display: none;">
            ‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–∏—Ç—å SERVER_URL –≤ –∫–æ–¥–µ! –ó–∞–º–µ–Ω–∏—Ç–µ 'https://six-yevf.onrender.com' –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π URL.
        </div>

        <div class="success-message">
            ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É!
        </div>

        <div class="info-card">
            <div class="info-title">
                <span class="status-indicator status-online"></span>
                –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            </div>
            <div class="info-text" id="connectionStatus">
                WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
            </div>
        </div>

        <div class="info-card">
            <div class="info-title">üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</div>
            <div class="info-text" id="userInfo">
                –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...
            </div>
        </div>

        <div class="info-card">
            <div class="info-title">üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
            <div class="info-text">
                <strong>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:</strong> Frontend (GitHub Pages) + Backend (Render)<br>
                <strong>–ü—Ä–æ—Ç–æ–∫–æ–ª:</strong> WebSocket + REST API<br>
                <strong>–°–µ—Ä–≤–µ—Ä:</strong> <span id="serverInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <div class="debug-info" id="debugInfo">
                –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...
            </div>
        </div>

        <button class="retry-btn" onclick="testConnection()">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</button>
        <button class="retry-btn" onclick="location.reload()">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </div>

    <script>
        // ‚ö†Ô∏è –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π URL —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ Render
        const SERVER_URL = 'https://six-yevf.onrender.com'; // ‚Üê –í–°–¢–ê–í–¨–¢–ï –í–ê–® URL

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let ws = null;
        let telegramId = null;
        let currentLanguage = 'ru';
        let isConnectionActive = false;
        let connectionAttempts = 0;
        let maxConnectionAttempts = 5;
        let debugLog = [];

        function addDebugLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.push(`[${timestamp}] ${message}`);
            const debugElement = document.getElementById('debugInfo');
            if (debugElement) {
                debugElement.textContent = debugLog.slice(-15).join('\n');
                debugElement.scrollTop = debugElement.scrollHeight;
            }
            console.log(message);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ URL —Å–µ—Ä–≤–µ—Ä–∞
        function checkServerURL() {
            if (SERVER_URL === 'https://six-yevf.onrender.com') {
                document.getElementById('urlWarning').style.display = 'block';
                addDebugLog('‚ö†Ô∏è WARNING: Please update SERVER_URL in the code!');
                showError('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–∏—Ç—å SERVER_URL –≤ –∫–æ–¥–µ');
                return false;
            }
            return true;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            addDebugLog('‚úÖ Telegram Web App API loaded');
        } else {
            addDebugLog('‚ùå Telegram Web App API not available');
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É
        function connectWebSocket() {
            if (!checkServerURL()) {
                return;
            }

            // WebSocket URL —á–µ—Ä–µ–∑ /ws endpoint
            const wsUrl = SERVER_URL.replace('https://', 'wss://').replace('http://', 'ws://') + '/ws';
            
            addDebugLog(`Connecting to: ${wsUrl}`);
            document.getElementById('loadingText').textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...';
            document.getElementById('serverUrl').textContent = wsUrl;
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = () => {
                addDebugLog('‚úÖ WebSocket connected');
                isConnectionActive = true;
                connectionAttempts = 0;
                document.getElementById('loadingText').textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram Web App...';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram Web App
                if (window.Telegram && window.Telegram.WebApp) {
                    const user = Telegram.WebApp.initDataUnsafe.user;
                    if (user && user.id) {
                        addDebugLog(`‚úÖ Telegram user found: ${user.first_name} (ID: ${user.id})`);
                        showLanguageSelection();
                    } else {
                        addDebugLog('‚ùå Telegram user data not found');
                        addDebugLog(`Raw data: ${JSON.stringify(Telegram.WebApp.initDataUnsafe)}`);
                        showError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram.\n\n–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∏–∑ Telegram —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É Menu –±–æ—Ç–∞.');
                    }
                } else {
                    addDebugLog('‚ùå Telegram Web App API not available');
                    showError('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∏–∑ Telegram');
                }
            };
            
            ws.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    addDebugLog(`üì® Received: ${data.type}`);
                    
                    if (data.type === 'user_synced') {
                        telegramId = data.telegram_id;
                        addDebugLog(`‚úÖ User synced: ${telegramId}`);
                        showSuccess(data);
                    } else if (data.type === 'error') {
                        addDebugLog(`‚ùå Server error: ${data.message}`);
                        showError(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${data.message}`);
                    } else if (data.type === 'pong') {
                        addDebugLog(`üèì Pong received: ${data.timestamp}`);
                        updateConnectionStatus(true);
                    }
                } catch (error) {
                    addDebugLog(`‚ùå Error parsing message: ${error.message}`);
                }
            };
            
            ws.onerror = (error) => {
                addDebugLog(`‚ùå WebSocket error: ${error.type || 'Unknown'}`);
                isConnectionActive = false;
                showError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É.\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å SERVER_URL –≤ –∫–æ–¥–µ.');
            };
            
            ws.onclose = (event) => {
                addDebugLog(`üîå WebSocket closed: ${event.code} - ${event.reason || 'No reason'}`);
                isConnectionActive = false;
                
                if (connectionAttempts < maxConnectionAttempts) {
                    connectionAttempts++;
                    document.getElementById('loadingText').textContent = 
                        `–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ... (${connectionAttempts}/${maxConnectionAttempts})`;
                    setTimeout(() => {
                        if (!isConnectionActive) {
                            connectWebSocket();
                        }
                    }, 3000);
                } else {
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ø—ã—Ç–æ–∫.\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å SERVER_URL\n2. –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–∞ Render\n3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ CORS');
                }
            };
        }

        // –í—ã–±–æ—Ä —è–∑—ã–∫–∞
        function selectLanguage(lang) {
            currentLanguage = lang;
            addDebugLog(`üåê Language selected: ${lang}`);
            document.getElementById('languageSelection').style.display = 'none';
            document.getElementById('loadingText').textContent = '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...';
            document.getElementById('loadingScreen').style.display = 'flex';
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const user = Telegram.WebApp.initDataUnsafe.user;
            if (user && user.id && ws && ws.readyState === WebSocket.OPEN) {
                const userData = {
                    type: 'sync_user',
                    telegram_id: user.id,
                    username: user.username || '',
                    first_name: user.first_name || '',
                    last_name: user.last_name || '',
                    photo_url: user.photo_url || '',
                    language: lang
                };
                
                addDebugLog(`üì§ Sending user sync: ${JSON.stringify(userData)}`);
                ws.send(JSON.stringify(userData));
            } else {
                addDebugLog('‚ùå Cannot sync user: missing data or connection');
                showError('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞
        function showLanguageSelection() {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('languageSelection').style.display = 'flex';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            document.getElementById('loadingScreen').style.display = 'flex';
            document.getElementById('languageSelection').style.display = 'none';
            document.getElementById('mainContainer').classList.remove('visible');
            
            // –ó–∞–º–µ–Ω—è–µ–º \n –Ω–∞ <br> –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const formattedMessage = message.replace(/\n/g, '<br>');
            document.getElementById('loadingText').innerHTML = `‚ùå ${formattedMessage}`;
            document.querySelector('.spinner').style.display = 'none';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–≤—Ç–æ—Ä–∞
            setTimeout(() => {
                const loadingText = document.getElementById('loadingText');
                loadingText.innerHTML += '<br><br><button onclick="location.reload()" style="background: #007aff; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>';
            }, 2000);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—Ö
        function showSuccess(userData) {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('languageSelection').style.display = 'none';
            document.getElementById('mainContainer').classList.add('visible');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            const telegramUser = Telegram.WebApp.initDataUnsafe.user;
            document.getElementById('userInfo').innerHTML = `
                <strong>ID:</strong> ${userData.telegram_id}<br>
                <strong>–ò–º—è:</strong> ${telegramUser.first_name} ${telegramUser.last_name || ''}<br>
                <strong>Username:</strong> @${telegramUser.username || '–Ω–µ —É–∫–∞–∑–∞–Ω'}<br>
                <strong>–Ø–∑—ã–∫:</strong> ${userData.language}<br>
                <strong>–õ–∏–º–∏—Ç –ø–æ—Å—Ç–æ–≤:</strong> ${userData.limits.used}/${userData.limits.total}
            `;
            
            updateConnectionStatus(true);
            getServerInfo();
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function updateConnectionStatus(isOnline) {
            const statusElement = document.getElementById('connectionStatus');
            const indicator = document.querySelector('.status-indicator');
            
            if (isOnline) {
                statusElement.textContent = 'WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ';
                indicator.className = 'status-indicator status-online';
            } else {
                statusElement.textContent = '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ';
                indicator.className = 'status-indicator status-offline';
            }
        }

        // –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Ä–≤–µ—Ä–µ
        async function getServerInfo() {
            try {
                const response = await fetch(`${SERVER_URL}/info`);
                const data = await response.json();
                
                document.getElementById('serverInfo').innerHTML = `
                    ${data.app} v${data.version}<br>
                    –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${data.clients_connected}<br>
                    WebSocket endpoint: ${data.endpoints.websocket}
                `;
                
                addDebugLog(`‚úÖ Server info received: ${JSON.stringify(data)}`);
            } catch (error) {
                addDebugLog(`‚ùå Failed to get server info: ${error.message}`);
                document.getElementById('serverInfo').textContent = '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏';
            }
        }

        // –¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        function testConnection() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                addDebugLog('üì§ Sending ping...');
                ws.send(JSON.stringify({ type: 'ping' }));
            } else {
                addDebugLog('‚ùå WebSocket not connected, reconnecting...');
                connectWebSocket();
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            addDebugLog('üöÄ App starting...');
            connectWebSocket();
        });

        // Heartbeat –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        setInterval(() => {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ type: 'ping' }));
            }
        }, 30000); // –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    </script>
</body>
</html>
